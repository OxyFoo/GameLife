name: '✋ GameLife - Build'

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Choose environment to build'
        required: true
        default: 'prod'
        type: choice
        options:
        - dev
        - test
        - prod
      actions:
        description: 'Choose platform to build'
        required: true
        default: 'both'
        type: choice
        options:
        - both
        - android
        - ios
      save-apk-artifact:
        description: 'Download apk artifact (android only)'
        required: false
        default: false
        type: boolean

jobs:
  tests:
    name: '🔍 Tests'
    uses: ./.github/workflows/step-tests.yml
    secrets: inherit
    with:
      environment: ${{ github.event.inputs.environment }}
      test-client: true
      test-database: true
      test-migration: false

  android:
    name: '🤖 Android'
    if: github.event.inputs.actions == 'both' || github.event.inputs.actions == 'android'
    needs: tests
    uses: ./.github/workflows/step-android.yml
    secrets: inherit
    with:
      environment: ${{ github.event.inputs.environment }}
      delivery: false
      save-apk-artifact: ${{ github.event.inputs.save-apk-artifact == 'true' }}

  ios:
    name: '🍏 iOS'
    if: github.event.inputs.actions == 'both' || github.event.inputs.actions == 'ios'
    needs: tests
    uses: ./.github/workflows/step-ios.yml
    secrets: inherit
    with:
      environment: ${{ github.event.inputs.environment }}
      delivery: false
